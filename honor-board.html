<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù - Ù…Ø®ÙŠÙ… ÙƒÙ†Ø²</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet" />
  <style>
    body { font-family: Cairo, sans-serif; background: #f4f4f4; margin:0;}
    header, footer {
      text-align: center;
      padding: 12px 10px;
      background-color: #e3f2fd;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      position: relative;
    }
    header h1 {margin:0;font-size:28px;color:#004aad;}
    header h2 {margin:8px 0 0;font-size:22px;color:#ff9800;}
    .back-home {text-align:right; margin: 15px 0;}
    .back-home a {
      background:#007bff;color:white;padding:8px 18px;text-decoration:none;border-radius:8px;font-weight:bold;
      display:inline-block;
    }
    .back-home a:hover {background:#0056b3;}
    .container {max-width: 900px; margin: 20px auto 0; background: #fff; border-radius: 12px; box-shadow: 0 2px 10px #0001; padding: 30px 18px;}
    h2 {text-align:center;}
    .filter-bar {text-align:right;margin-bottom:13px;}
    .filter-bar label {font-weight:bold;}
    .filter-bar select {padding:6px 14px; border-radius:7px; border:1px solid #bbb; font-family:Cairo,sans-serif;}
    table {width:100%;border-collapse:collapse;margin-top:10px;}
    th,td {padding:12px 8px;border-bottom:1px solid #ddd;text-align:center;}
    th {background-color: #f0f0f0;}
    tr:hover {background-color: #f9f9f9;}
    .rank-badge {background:#004aad;color:white;border-radius:50%;display:inline-block;width:30px;height:30px;line-height:30px;text-align:center;font-weight:bold;}
    .nav {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      max-width: 600px;
      margin: 16px auto 16px auto;
    }
    .nav a {
      background-color: #007bff;
      color: white;
      padding: 10px;
      text-align: center;
      border-radius: 8px;
      text-decoration: none;
      font-size: 14px;
      min-width: 120px;
      transition: background 0.2s;
    }
    .nav a#adminLink {background-color: #8e24aa;}
    .nav a#contestsLink {background-color: #1e88e5;}
    .nav a#scoresLink {background-color: #43a047;}
    .nav a#loginLink {background-color: #ff9800;color:#fff;font-weight:bold;}
    .nav a#logoutLink {background-color: #d32f2f;}
    .nav a#honorLink {background-color: #ff9800; color:#004aad; font-weight:bold;}
    .nav a:hover {background-color: #0056b3;}
    .nav a#adminLink:hover {background-color: #5e1972;}
    .nav a#contestsLink:hover {background-color: #1565c0;}
    .nav a#scoresLink:hover {background-color: #1b5e20;}
    .nav a#loginLink:hover {background-color: #e65100;}
    .nav a#logoutLink:hover {background-color: #b71c1c;}
    .nav a#honorLink:hover {background-color: #e65100; color:#fff;}
    footer {font-size:14px;color:#555;padding:6px 10px;}
    @media (max-width:650px) {
      .container {padding:10px 2px;}
      th,td {font-size:13px;}
      .filter-bar {font-size:14px;}
    }
  </style>
</head>
<body>
  <header>
    <h1>Ù…Ø®ÙŠÙ… ÙƒÙ…Ø¨ÙˆÙ†Ø¯ ÙƒÙ†Ø² Ø§Ù„ØµÙŠÙÙŠ</h1>
    <h2>ğŸ–ï¸ Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù ğŸ–ï¸</h2>
  </header>
  <div class="nav">
    <a href="participants.html" id="adminLink" style="display:none">ğŸ‘¥ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†</a>
    <a href="admin-contests.html" id="contestsLink" style="display:none">ğŸ† Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</a>
    <a href="admin-scores.html" id="scoresLink" style="display:none">ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø·</a>
    <a href="honor-board.html" id="honorLink" style="display:none">ğŸ† Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù</a>
    <a href="participant-scores.html" id="queryScoresLink">ğŸ” Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø§Ù„Ù†Ù‚Ø§Ø·</a>
    <a href="schedule.html">ğŸ“… Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ</a>
    <a href="points.html">ğŸ… Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø§Ø·</a>
    <a href="login.html" id="loginLink">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†</a>
    <a href="#" id="logoutLink" style="display:none">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
  </div>
  <div class="container">
    <div class="back-home">
      <a href="index.html">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    </div>
    <h2>Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù - Ø£Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù‚Ø§Ø·</h2>
    <div class="filter-bar">
      <label for="groupFilter">ÙÙ„ØªØ± Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¹Ù…Ø±ÙŠØ©:</label>
      <select id="groupFilter">
        <option value="all">Ø§Ù„ÙƒÙ„</option>
        <option value="10-12">10-12 Ø³Ù†Ø©</option>
        <option value="13-15">13-15 Ø³Ù†Ø©</option>
        <option value="16-18">16-18 Ø³Ù†Ø©</option>
      </select>
    </div>
    <table>
      <thead>
        <tr>
          <th>Ø§Ù„ØªØ±ØªÙŠØ¨</th>
          <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ</th>
          <th>Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ</th>
          <th>Ø±Ù‚Ù… Ø§Ù„ÙˆØ­Ø¯Ø©</th>
          <th>Ø§Ù„Ø¹Ù…Ø±</th>
          <th>Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¹Ù…Ø±ÙŠØ©</th>
          <th>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·</th>
        </tr>
      </thead>
      <tbody id="honorBody">
        <tr><td colspan="7">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
      </tbody>
    </table>
  </div>
  <footer>
    All Right Reserved Â© 2025 Genius Tech Co
  </footer>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    const firebaseConfig = {
      apiKey: "AIzaSyBic0WV6onX8hafXI09_6N-HUdNiAMJJS0",
      authDomain: "kenz-camp.firebaseapp.com",
      projectId: "kenz-camp",
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø¸Ù‡ÙˆØ± Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
    function handleNavDisplay(user) {
      if (user) {
        document.getElementById("adminLink").style.display = "inline-block";
        document.getElementById("contestsLink").style.display = "inline-block";
        document.getElementById("scoresLink").style.display = "inline-block";
        document.getElementById("honorLink").style.display = "inline-block";
        document.getElementById("logoutLink").style.display = "inline-block";
        document.getElementById("loginLink").style.display = "none";
      } else {
        document.getElementById("adminLink").style.display = "none";
        document.getElementById("contestsLink").style.display = "none";
        document.getElementById("scoresLink").style.display = "none";
        document.getElementById("honorLink").style.display = "none";
        document.getElementById("logoutLink").style.display = "none";
        document.getElementById("loginLink").style.display = "inline-block";
      }
    }
    onAuthStateChanged(auth, (user) => {
      if (!user) window.location.href = "login.html";
      else handleNavDisplay(user);
    });
    document.getElementById("logoutLink").onclick = (e) => {
      e.preventDefault();
      signOut(auth);
    };

    // Ø­Ø³Ø§Ø¨ ÙˆØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø§Ø· Ù„ÙƒÙ„ Ù…Ø´Ø§Ø±Ùƒ
    async function loadHonorBoard() {
      const honorTbody = document.getElementById("honorBody");
      honorTbody.innerHTML = `<tr><td colspan="7">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>`;
      // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†
      const participantsSnap = await getDocs(collection(db, "participants"));
      const participants = {};
      participantsSnap.forEach(docSnap => {
        const d = docSnap.data();
        if (!d.participantNumber) return;
        participants[d.participantNumber] = {
          name: d.name,
          number: d.participantNumber,
          guardian: d.guardian,
          age: d.age,
          group: d.group,
          total: 0
        };
      });
      if (!Object.keys(participants).length) {
        honorTbody.innerHTML = `<tr><td colspan="7">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙƒÙˆÙ†</td></tr>`;
        return;
      }
      // Ø¬Ù„Ø¨ ÙƒÙ„ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª
      const contestsSnap = await getDocs(collection(db, "contests"));
      const contestIds = [];
      contestsSnap.forEach(docSnap => contestIds.push(docSnap.id));
      // Ø¬Ù„Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ù…Ù† contestScores
      for (const contestId of contestIds) {
        const scoreDoc = await getDoc(doc(db, "contestScores", contestId));
        if (scoreDoc.exists() && scoreDoc.data().scores) {
          const scores = scoreDoc.data().scores;
          for (const partNum in scores) {
            if (participants[partNum]) {
              participants[partNum].total += parseInt(scores[partNum] || 0);
            }
          }
        }
      }
      // Ø­ÙˆÙ„Ù‡Ù… Ù„Ù…ØµÙÙˆÙØ© ÙˆØ±ØªØ¨Ù‡Ù…
      let participantsArr = Object.values(participants);
      // ØªØ±ØªÙŠØ¨ ØªÙ†Ø§Ø²Ù„ÙŠ Ø¨Ø§Ù„Ù†Ù‚Ø§Ø·ØŒ Ø«Ù… Ø£Ø¨Ø¬Ø¯ÙŠ Ù„Ù„Ø£Ø³Ù…Ø§Ø¡ ÙÙŠ Ø­Ø§Ù„ Ø§Ù„ØªØ³Ø§ÙˆÙŠ
      participantsArr.sort((a, b) => b.total - a.total || a.name.localeCompare(b.name, 'ar'));
      // Ø­ÙØ¸ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù„Ù„ÙÙ„ØªØ±Ø©
      window._allHonorRows = participantsArr;
      renderHonorRows(participantsArr);
    }
    function renderHonorRows(arr) {
      const honorTbody = document.getElementById("honorBody");
      if (!arr.length) {
        honorTbody.innerHTML = `<tr><td colspan="7">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ø¹Ø±Ø¶Ù‡Ø§</td></tr>`;
        return;
      }
      let html = "";
      let rank = 1;
      arr.forEach(part => {
        html += `
        <tr>
          <td><span class="rank-badge">${rank++}</span></td>
          <td>${part.name}</td>
          <td>${part.number}</td>
          <td>${part.guardian}</td>
          <td>${part.age}</td>
          <td>${part.group}</td>
          <td style="font-weight:bold;color:#004aad;">${part.total}</td>
        </tr>`;
      });
      honorTbody.innerHTML = html;
    }
    // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¹Ù…Ø±ÙŠØ©
    document.getElementById("groupFilter").addEventListener("change", function() {
      let arr = window._allHonorRows || [];
      const value = this.value;
      if (value !== "all") {
        arr = arr.filter(p => p.group === value);
      }
      renderHonorRows(arr);
    });

    window.addEventListener("DOMContentLoaded", loadHonorBoard);
  </script>
</body>
</html>